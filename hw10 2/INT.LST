8086/87/88/186 MACRO ASSEMBLER    INT                                                      20:25:06  01/07/;6  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE INT
OBJECT MODULE PLACED IN INT.OBJ
ASSEMBLER INVOKED BY:  C:\UTIL\ASM86.EXE INT.ASM M1 EP DB


LOC  OBJ                  LINE     SOURCE

                             1     NAME    INT
                             2     
                             3     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                             4     ;                                                                            ;
                             5     ;                                    INT                                     ;
                             6     ;                         RoboTrike Interrupt 2 Installer                    ;
                             7     ;                                 EE/CS 51                                   ;
                             8     ;                                                                            ;
                             9     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                            10     
                            11     ; Description:       This program initializes and installs the interrupt
                            12     ;                    2 for the interrupt handler in serialr.asm. The public
                            13     ;                    functions included are:
                            14     ;                        InitInt  2           - initalizes int 2
                            15     ;                        InstallInt2Handler   - installs the int 2 handler
                            16     ;
                            17     ; Revision History:
                            18     ;     11/25/15  Nancy Cao         initial code and comments
                            19     ;     11/30/15  Nancy Cao         updated comments
                            20     
                            21     ; local include files
                            22 +1  $INCLUDE(INT.INC)         ; display constants for interrupt 2
                      =1    23     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      =1    24     ;                                                                            ;
                      =1    25     ;                                   INT.INC                                  ;
                      =1    26     ;                            Interrupt 2 Definitions                         ;
                      =1    27     ;                                 Include File                               ;
                      =1    28     ;                                                                            ;
                      =1    29     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                      =1    30     
                      =1    31     ; This file contains the definitions for the interrupt 2 functions.
                      =1    32     ;
                      =1    33     ; Revision History:
                      =1    34     ;     11/25/15   Nancy Cao      initial revisions and comments
                      =1    35     
                      =1    36     ; Interrupt Vectors
  000E                =1    37     Int2Vec         EQU 14                 ; interrupt vector for int 2
                      =1    38     
                      =1    39     ; definitions
                      =1    40     
  0017                =1    41     Int2Val         EQU 0000000000010111B  ; 00000000000----- reserved
                      =1    42                                            ; -----------0---- set level triggering
                      =1    43                                            ; ------------0--- enable interrupts
                      =1    44                                            ; -------------111 priority level
                      =1    45                                            
                      =1    46                                            
                      =1    47                                            
  0004                =1    48     VECTOR_SIZE     EQU 4                  ; the size of a vector
  0002                =1    49     BYTE_SIZE       EQU 2                  ; the size of a byte
  0100                =1    50     TOTAL_VECT      EQU 256                ; the number of vectors to initialize
8086/87/88/186 MACRO ASSEMBLER    INT                                                      20:25:06  01/07/;6  PAGE    2


LOC  OBJ                  LINE     SOURCE

                      =1    51     
                      =1    52     
  FF3C                =1    53     INT2Ctrl        EQU     0FF3CH         ; address of interrupt 2 control register
                            54     
                            55     EXTRN SerialInterruptHandler:NEAR ; the interrupt handler from serialr.asm that
                            56                                       ; uses int 2.
                            57     
                            58     CGROUP  GROUP   CODE
                            59     
----                        60     CODE    SEGMENT PUBLIC 'CODE'
                            61     
                            62     
                            63             ASSUME  CS:CGROUP
                            64     
                            65     ; InitInt2
                            66     ;
                            67     ; Description:       Initialize the 80188 INT 2.  INT 2 is set to level
                            68     ;                    triggering.
                            69     ;
                            70     ; Operation:         The appropriate value is written into the interrupt 2
                            71     ;                    control register.
                            72     ;
                            73     ; Arguments:         None.
                            74     ; Return Value:      None.
                            75     ;
                            76     ; Local Variables:   None.
                            77     ; Shared Variables:  None.
                            78     ; Global Variables:  None.
                            79     ;
                            80     ; Input:             None.
                            81     ; Output:            None.
                            82     ;
                            83     ; Error Handling:    None.
                            84     ;
                            85     ; Algorithms:        None.
                            86     ; Data Structures:   None.
                            87     ;
                            88     ; Registers Changed: AX, DX
                            89     ;
                            90     ; Author:            Nancy Cao
                            91     ; Revision History:
                            92     ;     11/25/15  Nancy Cao   initial revision and comments
                            93     ;     11/30/15  Nancy Cao   updated comments
                            94     
0000                        95     InitInt2     PROC        NEAR
                            96                  PUBLIC      InitInt2
                            97     
0000                        98     StartIntInit:
0000 BA3CFF                 99             MOV     DX, INT2Ctrl ; send an interrupt 2 control register
0003 B81700                100             MOV     AX, Int2Val
0006 EF                    101             OUT     DX, AX
                           102     
0007 C3                    103             RET                     ;done so return
                           104     
                           105     InitInt2      ENDP
8086/87/88/186 MACRO ASSEMBLER    INT                                                      20:25:06  01/07/;6  PAGE    3


LOC  OBJ                  LINE     SOURCE

                           106     
                           107     ; InstallInt2Handler
                           108     ;
                           109     ; Description:       Install the event handler for the int 2 interrupt.
                           110     ;
                           111     ; Operation:         Writes the address of the int 2 event handler to the
                           112     ;                    appropriate interrupt vector.
                           113     ;
                           114     ; Arguments:         None.
                           115     ; Return Value:      None.
                           116     ;
                           117     ; Local Variables:   None.
                           118     ; Shared Variables:  None.
                           119     ; Global Variables:  None.
                           120     ;
                           121     ; Input:             None.
                           122     ; Output:            None.
                           123     ;
                           124     ; Error Handling:    None.
                           125     ;
                           126     ; Algorithms:        None.
                           127     ; Data Structures:   None.
                           128     ;
                           129     ; Registers Changed: flags, AX, ES
                           130     ;
                           131     ; Author:            Nancy Cao
                           132     ; Revision History:
                           133     ;     11/25/15  Nancy Cao   initial revision and comments
                           134     ;     11/30/15  Nancy Cao   updated comments
                           135     
0008                       136     InstallInt2Handler    PROC    NEAR
                           137                           PUBLIC  InstallInt2Handler
                           138     
0008 33C0                  139         XOR     AX, AX          ;clear ES (interrupt vectors are in segment 0)
000A 8EC0                  140         MOV     ES, AX
                           141                                     ;store the vector
000C 26C70638000000 E      142         MOV     ES: WORD PTR (VECTOR_SIZE * Int2Vec), OFFSET(SerialInterruptHandler)
0013 26C7063A00---- E      143         MOV     ES: WORD PTR (VECTOR_SIZE * Int2Vec + BYTE_SIZE), SEG(SerialInterruptHand
                                   ler)
                           144     
                           145     
001A C3                    146         RET                     ;all done, return
                           147     
                           148     
                           149     InstallInt2Handler  ENDP
                           150     
----                       151     CODE ENDS
                           152     
                           153     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
